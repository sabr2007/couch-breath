# –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Scheduler

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** | 4 |
| **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤** | 56+ |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ —Ç–µ—Å—Ç–æ–≤** | ~2,000 |
| **–ü–æ–∫—Ä—ã—Ç–∏–µ –º–æ–¥—É–ª–µ–π** | `scheduler.py`, `queries.py` |
| **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤** | Unit, Integration, Scenario, Edge Cases |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
couch-breath/
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py              # –§–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (290 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ test_queries.py          # Unit-—Ç–µ—Å—Ç—ã SQL (22 —Ç–µ—Å—Ç–∞)
‚îÇ   ‚îú‚îÄ‚îÄ test_scheduler.py        # Integration-—Ç–µ—Å—Ç—ã (15 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ test_scenarios.py        # –°—Ü–µ–Ω–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã (9 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ test_edge_cases.py       # –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (20 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ README.md                # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ init_test_db.py          # –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
‚îú‚îÄ‚îÄ requirements-test.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ pytest.ini                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ run_tests.sh                 # –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ TESTING_QUICKSTART.md        # –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ TESTING_SUMMARY.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ .env.test.example            # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. Unit-—Ç–µ—Å—Ç—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (22 —Ç–µ—Å—Ç–∞)

**–§–∞–π–ª:** `test_queries.py`

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ `get_users_ready_for_next_lesson()` (6 —Ç–µ—Å—Ç–æ–≤)
  - –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω 2 –¥–Ω—è –Ω–∞–∑–∞–¥ ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–ø–∏—Å–æ–∫
  - –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω < 1 –¥–Ω—è –Ω–∞–∑–∞–¥ ‚Üí –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç
  - –†–æ–≤–Ω–æ 1 –¥–µ–Ω—å –Ω–∞–∑–∞–¥ ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç
  - –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç ‚Üí –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
  - –ü–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫ (18) ‚Üí –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç
  - –£—Ä–æ–∫ –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω ‚Üí –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç

- ‚úÖ `unlock_next_lesson()` (3 —Ç–µ—Å—Ç–∞)
  - –£—Å–ø–µ—à–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —É—Ä–æ–∫–∞
  - –ù–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–∫–∞ (18 ‚Üí 19) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç None
  - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

- ‚úÖ `get_users_for_reminder()` (5 —Ç–µ—Å—Ç–æ–≤)
  - –ù–µ–∞–∫—Ç–∏–≤–µ–Ω 3 –¥–Ω—è ‚Üí –º—è–≥–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
  - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ‚Üí –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç
  - –ù–µ–∞–∫—Ç–∏–≤–µ–Ω 7 –¥–Ω–µ–π ‚Üí –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
  - –ù–µ–∞–∫—Ç–∏–≤–µ–Ω 15 –¥–Ω–µ–π ‚Üí –ù–ï –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
  - –ù–µ –∑–∞—á–∏—Å–ª–µ–Ω ‚Üí –ù–ï –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ

- ‚úÖ `log_reminder()` (2 —Ç–µ—Å—Ç–∞)
  - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ reminders
  - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

- ‚úÖ `update_last_activity()` (1 —Ç–µ—Å—Ç)
  - –û—á–∏—Å—Ç–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### 2. Integration-—Ç–µ—Å—Ç—ã scheduler (15 —Ç–µ—Å—Ç–æ–≤)

**–§–∞–π–ª:** `test_scheduler.py`

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ `check_lesson_unlocks()` (7 —Ç–µ—Å—Ç–æ–≤)
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ enrollment –∏ user_progress
  - –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
  - –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí –≤—Å–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
  - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
  - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
  - –ü–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–∫ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

- ‚úÖ `send_reminders()` (8 —Ç–µ—Å—Ç–æ–≤)
  - –ú—è–≥–∫–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (3 –¥–Ω—è)
  - –ù–∞—Å—Ç–æ–π—á–∏–≤–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (7 –¥–Ω–µ–π)
  - –û–±–∞ —Ç–∏–ø–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
  - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
  - –ù–µ —Å–ø–∞–º–∏—Ç—å –ø–æ—Å–ª–µ 14 –¥–Ω–µ–π
  - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

### 3. –°—Ü–µ–Ω–∞—Ä–Ω—ã–µ —Ç–µ—Å—Ç—ã (9 —Ç–µ—Å—Ç–æ–≤)

**–§–∞–π–ª:** `test_scenarios.py`

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç:** `CourseSimulator` –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫—É—Ä—Å–∞

**–°—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å: –î–ó ‚Üí +2 –¥–Ω—è ‚Üí —É—Ä–æ–∫ ‚Üí –î–ó ‚Üí +2 –¥–Ω—è ‚Üí —É—Ä–æ–∫
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 3 –¥–Ω—è: —É—Ä–æ–∫ ‚Üí –î–ó —á–µ—Ä–µ–∑ 3 –¥–Ω—è ‚Üí +2 –¥–Ω—è ‚Üí —É—Ä–æ–∫
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫ —É—Ä–æ–∫–∞: –Ω–µ —Å–¥–∞—ë—Ç –î–ó 7 –¥–Ω–µ–π ‚Üí –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (3–¥, 7–¥)
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫—É—Ä—Å: –≤—Å–µ 18 —É—Ä–æ–∫–æ–≤ –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç—É–¥–µ–Ω—Ç: —Å–¥–∞—ë—Ç –î–ó —Å—Ä–∞–∑—É ‚Üí –≤—Å—ë —Ä–∞–≤–Ω–æ –∂–¥—ë—Ç +2 –¥–Ω—è
- ‚úÖ –ù–µ—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ: —Ä–∞–∑–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É —É—Ä–æ–∫–∞–º–∏
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞ (20 –¥–Ω–µ–π)
- ‚úÖ –ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

### 4. –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (20 —Ç–µ—Å—Ç–æ–≤)

**–§–∞–π–ª:** `test_edge_cases.py`

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã (3 —Ç–µ—Å—Ç–∞)
  - –†–æ–≤–Ω–æ 24 —á–∞—Å–∞
  - 23:59 (–º–µ–Ω—å—à–µ 1 –¥–Ω—è)
  - 24:01 (–±–æ–ª—å—à–µ 1 –¥–Ω—è)

- ‚úÖ –ì—Ä–∞–Ω–∏—Ü—ã —É—Ä–æ–∫–æ–≤ (3 —Ç–µ—Å—Ç–∞)
  - –ü–µ—Ä–µ—Ö–æ–¥ 1 ‚Üí 2
  - –ü–µ—Ä–µ—Ö–æ–¥ 17 ‚Üí 18
  - –ü–æ–ø—ã—Ç–∫–∞ 18 ‚Üí 19 (–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

- ‚úÖ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (2 —Ç–µ—Å—Ç–∞)
  - Race condition –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
  - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ –≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è —É—Ä–æ–∫–∞

- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î (3 —Ç–µ—Å—Ç–∞)
  - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π enrollment
  - –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π user_progress
  - –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π completed_at (NULL)

- ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (3 —Ç–µ—Å—Ç–∞)
  - –†–æ–≤–Ω–æ 3 –¥–Ω—è –Ω–∞–∑–∞–¥
  - –†–æ–≤–Ω–æ 14 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ (–≥—Ä–∞–Ω–∏—Ü–∞)
  - –û–±–∞ —Ç–∏–ø–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã

- ‚úÖ –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å –±–æ—Ç–æ–º (2 —Ç–µ—Å—Ç–∞)
  - _bot = None (–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
  - bot.send_message() –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (1 —Ç–µ—Å—Ç)
  - 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| `pytest` | –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ |
| `pytest-asyncio` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ async/await |
| `pytest-cov` | –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ |
| `freezegun` | –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `unittest.mock` | –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram API |

## üîç –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
- –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∏–∫—Å—Ç—É—Ä—É `db_clean` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ë–î
- –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
- –¢–µ—Å—Ç—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ

### 2. –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏
- –¢–µ—Å—Ç—ã –Ω–µ –∂–¥—É—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã –≤ –ë–î
- `CourseSimulator` –ø–æ–∑–≤–æ–ª—è–µ—Ç "–ø–µ—Ä–µ–º–∞—Ç—ã–≤–∞—Ç—å" –≤—Ä–µ–º—è

### 3. –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ
- `mock_bot` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–∑–æ–≤–æ–≤ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ `send_message()`
- –°–∏–º—É–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### 5. –°—Ü–µ–Ω–∞—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `CourseSimulator` –¥–ª—è E2E —Å–∏–º—É–ª—è—Ü–∏–∏
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Ä–æ–∫–∞
- –†–∞–∑–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è

## üìà –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

**–¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- ‚úÖ `bot/services/scheduler.py`: ‚â• 80%
- ‚úÖ `bot/database/queries.py`: ‚â• 90%

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
pytest --cov=bot/services/scheduler.py --cov=bot/database/queries.py --cov-report=term-missing
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements-test.txt

# 2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
createdb couch_breath_test

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export TEST_DATABASE_URL="postgresql://postgres:postgres@localhost:5432/couch_breath_test"

# 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
python scripts/init_test_db.py

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `tests/README.md` | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (400+ —Å—Ç—Ä–æ–∫) |
| `TESTING_QUICKSTART.md` | –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ |
| `TESTING_SUMMARY.md` | –≠—Ç–∞ —Å–≤–æ–¥–∫–∞ |

## ‚ú® –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ)
pytest tests/test_queries.py

# –¢–æ–ª—å–∫–æ integration-—Ç–µ—Å—Ç—ã
pytest tests/test_scheduler.py

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=bot --cov-report=html

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/test_queries.py::test_get_users_ready_for_next_lesson_basic -v

# –ü–æ –º–∞—Ä–∫–µ—Ä–∞–º
pytest -m unit
pytest -m integration
pytest -m scenario
pytest -m edge

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest -vv

# –° –æ—Ç–ª–∞–¥—á–∏–∫–æ–º
pytest --pdb
```

## üéØ –ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

### –§—É–Ω–∫—Ü–∏–∏ scheduler.py
- ‚úÖ `check_lesson_unlocks()` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ `send_reminders()` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

### –§—É–Ω–∫—Ü–∏–∏ queries.py
- ‚úÖ `get_users_ready_for_next_lesson()` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ `unlock_next_lesson()` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ `get_users_for_reminder()` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ `log_reminder()` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ‚úÖ `update_last_activity()` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é

### –°—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –∫—É—Ä—Å–∞
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∏ –≤ —Å–¥–∞—á–µ –î–ó
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫—É—Ä—Å (18 —É—Ä–æ–∫–æ–≤)
- ‚úÖ –ù–µ—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ
- ‚úÖ –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### Edge Cases
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã (24h, 23:59, 24:01)
- ‚úÖ –ì—Ä–∞–Ω–∏—Ü—ã —É—Ä–æ–∫–æ–≤ (1‚Üí2, 17‚Üí18, 18‚Üí‚àÖ)
- ‚úÖ Race conditions
- ‚úÖ –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –û—à–∏–±–∫–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

## üîß CI/CD

–¢–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å GitHub Actions, GitLab CI, –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ CI/CD —Å–∏—Å—Ç–µ–º–∞–º–∏.

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `tests/README.md`.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–ü—Ä–æ–±–ª–µ–º—ã?**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TESTING_QUICKSTART.md`
2. –°–º–æ—Ç—Ä–∏—Ç–µ `tests/README.md`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å `-vv` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--pdb` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

**–í–µ—Ä—Å–∏—è:** 1.0.0
**–î–∞—Ç–∞:** 2026-01-07
**–ê–≤—Ç–æ—Ä:** Claude Code
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
