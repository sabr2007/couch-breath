# ะะดะธะฝัะน ะะฐััะตั-ะฟะปะฐะฝ: Telegram-ะฑะพั ะพะฑัะฐะทะพะฒะฐัะตะปัะฝะพะณะพ ะบัััะฐ ั AI-ะะตะฝัะพัะพะผ

## ะััั: "ะััะฐะฝะธะต ะขัะตะฝะตัะฐ"

## ะะณะปะฐะฒะปะตะฝะธะต

1. [ะะฑะทะพั ะฟัะพะตะบัะฐ]

2. [ะกัััะบัััะฐ ะบัััะฐ]

3. [User Journey (ะกัะตะฝะฐัะธะน ะฒะทะฐะธะผะพะดะตะนััะฒะธั)]

4. [Must-Have ััะฝะบัะธะธ]

5. [ะขะตัะฝะธัะตัะบะฐั ะฐััะธัะตะบัััะฐ]

6. [ะะฐะทะฐ ะดะฐะฝะฝัั]

7. [AI-ะะตะฝัะพั: ะัะพะผะฟัั ะธ ะปะพะณะธะบะฐ]

8. [ะะดะผะธะฝ-ะฟะฐะฝะตะปั]

9. [ะขะตัะฝะธัะตัะบะธะน ััะตะบ]

10. [ะะธัะบะธ ะธ ะผะธัะธะณะฐัะธั]

  

---

  

## 1. ะะฑะทะพั ะฟัะพะตะบัะฐ

  

**ะะฐะทะฒะฐะฝะธะต ะบัััะฐ:** "ะััะฐะฝะธะต ะขัะตะฝะตัะฐ" ย

**ะกัะฐัั ะบัััะฐ:** 12 ัะฝะฒะฐัั 2026 ย

**ะะพะปะธัะตััะฒะพ ััะพะบะพะฒ:** 18 ััะพะบะพะฒ (ะฒะบะปััะฐั 1 ะฑะพะฝััะฝัะน) ย

**ะฃัะพะบะธ ะฑะตะท ะะ:** โ8 (ะัะตะฝั) ะธ โ18 (ะะพะฝัั)

  

**ะฆะตะปั ะฑะพัะฐ:** Telegram-ะฑะพั ะดะปั ะฟัะพัะพะถะดะตะฝะธั ะบัััะฐ ั:

  

- ะะพัะฐะณะพะฒัะผ ะพัะบัััะธะตะผ ััะพะบะพะฒ (ะฟะพัะปะต ัะดะฐัะธ ะะ + 1 ะดะตะฝั)

- AI-ะฟัะพะฒะตัะบะพะน ะดะพะผะฐัะฝะธั ะทะฐะดะฐะฝะธะน (ัะธะปััั ะผััะพัะฐ + ะฟะพะดะดะตัะถะธะฒะฐััะธะน ัะธะดะฑัะบ)

- ะะฐะฟะพะผะธะฝะฐะฝะธัะผะธ ะดะปั ะฝะตะฐะบัะธะฒะฝัั ัััะดะตะฝัะพะฒ

- ะัะพะบัะธ-ะฟะพะดะดะตัะถะบะพะน ัะตัะตะท ะถะธะฒัั ะบััะฐัะพัะพะฒ

- Broadcast-ัะฒะตะดะพะผะปะตะฝะธัะผะธ ะพั ะฐะดะผะธะฝะฐ (ะดะปั ะฐะฝะพะฝัะพะฒ ะฟัะฐะบัะธะบ)

  

**ะะปััะตะฒัะต ะฟัะธะฝัะธะฟั:**

  

- ะขะฐะนะผะทะพะฝะฐ: `Asia/Almaty` (UTC+5)

- **ะะฐะถะดัะน ัััะดะตะฝั ะธะดะตั ะฒ ัะฒะพะตะผ ัะตะผะฟะต**

- ะัะบัััะธะต ััะพะบะฐ = ัะดะฐัะฐ ะฟัะตะดัะดััะตะณะพ ะะ + 1 ะดะตะฝั ะพะถะธะดะฐะฝะธั

- ะะตัะตัะดะฐัะฐ ะะ: ะฝะตะพะณัะฐะฝะธัะตะฝะฝะพ, ะฝะพ ะฝะต ะฑะพะปะตะต **7 ัะพะพะฑัะตะฝะธะน ะฒ ัะฐั** (ะฐะฝัะธัะฟะฐะผ)

- ะะฐะฟะพะผะธะฝะฐะฝะธั ะทะฐะฑัะพัะตะฝะฝัะผ ัััะดะตะฝัะฐะผ

- ะะถะธะดะฐะตะผะพะต ะบะพะปะธัะตััะฒะพ ัััะดะตะฝัะพะฒ: **ะดะพ 50 ัะตะปะพะฒะตะบ**

  

---

  

## 2. ะกัััะบัััะฐ ะบัััะฐ

  

### ะะฐัะฟะธัะฐะฝะธะต ััะพะบะพะฒ (ะะกะะะะะะะะะะฏ ะะฃะะะะะฆะะฏ)

  

|โ|ะะฐะทะฒะฐะฝะธะต ััะพะบะฐ|ะะ?|ะขะธะฟ ะะ|YouTube|

|---|---|---|---|---|

|1|ะงัะพ ะตััั ััะตะฝะธะฝะณ?|โ|ะขะตะบัั|wERSPxhPqXg|

|2|ะกะฟะพัะพะฑั ะฟะตัะตะดะฐัะธ ะทะฝะฐะฝะธะน|โ|ะขะตะบัั|h5maY1xalH4|

|3|ะัะพะฑะตะฝะฝะพััะธ ะพะฑััะตะฝะธั ะฒะทัะพัะปัั|โ|ะขะตะบัั|j4DsZ-2WT6U|

|4|ะฆะธะบะป ะะพะปะฑะฐ ะฝะฐ ะฟัะฐะบัะธะบะต|โ|**ะะธะดะตะพ** (ัััะปะบะฐ)|qXtR2rbLP_E|

|5|ะะตัะพะดั ัะฐะฑะพัั ั ะณััะฟะฟะพะน|โ|ะขะตะบัั|okHIGqNYWZQ|

|6|ะกะตะทะพะฝะฝะพััั: ะะตัะฝะฐ|โ|ะขะตะบัั|otgThzHjWBY|

|7|ะกะตะทะพะฝะฝะพััั: ะะตัะพ|โ|ะขะตะบัั|3crwHSV8ar8|

|8|ะกะตะทะพะฝะฝะพััั: ะัะตะฝั|โ|โ|cbaWx59WTTQ|

|9|ะกะตะทะพะฝะฝะพััั: ะะธะผะฐ|โ|**ะะธะดะตะพ** (ัััะปะบะฐ)|UfSAL5mTWJ4|

|10|ะััะฟะฟะพะฒะฐั ะดะธะฝะฐะผะธะบะฐ|โ|ะขะตะบัั|P0mf-Gqsyuc|

|11|ะฆะธะบะป ะะพะปะฑะฐ: ัะพัะผะธัะพะฒะฐะฝะธะต ะฝะฐะฒัะบะฐ|โ|**ะคะฐะนะป**|YNuqggee1hI|

|12|ะะตัะปะตะพะฑัะฐะทะฝะพะต ัะฐะทะฒะธัะธะต|โ|ะขะตะบัั/ะคะฐะนะป|aFyub7ji1v8|

|13|ะะธัะฐะผะธะดะฐ ะพะฑััะตะฝะธั|โ|ะขะตะบัั|jfQx05gSqI8|

|14|ะะฐััะธัะฐ ะพัะพะทะฝะฐะฝะฝะพััะธ|โ|ะขะตะบัั|80dx8YJf6Ms|

|15|ะะพะฝั ัะฐะทะฒะธัะธั ะฟะพ ะัะณะพััะบะพะผั|โ|ะขะตะบัั|-crlu_B44d8|

|16|ะฆะฒะตัะพะฒะพะน ะฟัะพัะธะปั ััะตะฝะตัะฐ|โ|ะขะตะบัั|iIxARBNwpsk|

|17|ะฃะฝะธะบะฐะปัะฝัะน ััะธะปั ัะตัะตะท ัะตะฝะฝะพััะธ|โ|ะขะตะบัั|k2aFgspqDnM|

|18|ะะพะฝัั: ะกะธะฝะดัะพะผ ัะฐะผะพะทะฒะฐะฝัะฐ|โ|โ|GpUNjX_7e4Y|

  

**ะัะพะณะพ:** 18 ััะพะบะพะฒ (16 ั ะะ + 2 ะฑะตะท ะะ)

  

### ะฃัะพะบะธ ะฑะตะท ะะ:

  

- **ะฃัะพะบ 8** (ะกะตะทะพะฝะฝะพััั: ะัะตะฝั) โ ะบะฝะพะฟะบะฐ ยซะะทััะตะฝะพ โยป

- **ะฃัะพะบ 18** (ะะพะฝัั: ะกะธะฝะดัะพะผ ัะฐะผะพะทะฒะฐะฝัะฐ) โ ะบะฝะพะฟะบะฐ ยซะะทััะตะฝะพ โยป

  

### ะขะธะฟั ะะ:

  

- **ะขะตะบัั** โ 13 ััะพะบะพะฒ (AI ะฟัะพะฒะตััะตั ะธ ะดะฐะตั ะฟะตััะพะฝะฐะปัะฝัะน ัะธะดะฑัะบ)

- **ะะธะดะตะพ** โ 2 ััะพะบะฐ (4, 9) โ ัััะดะตะฝั ะฟัะธััะปะฐะตั ัััะปะบั YouTube, ะฑะพั ะฟัะธะฝะธะผะฐะตั ั ะฟัะพัััะผ ัะพะพะฑัะตะฝะธะตะผ

- **ะคะฐะนะป** โ 2 ััะพะบะฐ (11, 12) โ ัััะดะตะฝั ะฟัะธััะปะฐะตั ะดะพะบัะผะตะฝั, ะฑะพั ะฟัะธะฝะธะผะฐะตั ั ะฟัะพัััะผ ัะพะพะฑัะตะฝะธะตะผ

  

### ะะพะณะธะบะฐ ะพัะบัััะธั ััะพะบะพะฒ

  

```

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ ยะะะะะะะ (ะฟัะพััะพะต): ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ

โ ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ

โ ย1. ะกัะฐัั ะบัััะฐ: 12 ัะฝะฒะฐัั 2026 ย ย ย ย ย ย ย ย ย ย ย ย โ

โ ย2. ะฃัะพะบ N+1 ะพัะบััะฒะฐะตััั ัะตัะตะท 1 ะดะตะฝั ะฟะพัะปะต ัะดะฐัะธ ย ย ย โ

โ ย ย ะะ ะฟะพ ััะพะบั N ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ

โ ย3. ะะฐะถะดัะน ัััะดะตะฝั ะธะดะตั ะฒ ัะฒะพะตะผ ัะตะผะฟะต ย ย ย ย ย ย ย ย ย โ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

  

ะะดะตะฐะปัะฝัะน ััะตะฝะฐัะธะน:

โโ 12.01 โ ะฃัะพะบ 1 (ัะดะฐะป ะะ ะฒ ัะพั ะถะต ะดะตะฝั)

โโ 14.01 โ ะฃัะพะบ 2 ะพัะบััั

โโ 16.01 โ ะฃัะพะบ 3 ะพัะบััั (ะตัะปะธ ัะดะฐะป ะฃัะพะบ 2)

โโ ... ะธ ัะฐะบ ะดะฐะปะตะต

  

ะะตะดะปะตะฝะฝัะน ัััะดะตะฝั:

โโ 12.01 โ ะฃัะพะบ 1

โโ 15.01 โ ะกะดะฐะป ะะ (ัะตัะตะท 3 ะดะฝั)

โโ 16.01 โ ะฃัะพะบ 2 ะพัะบััั

โโ ะะดะตั ะฒ ัะฒะพะตะผ ัะตะผะฟะต

```

  

### ะะดะผะธะฝัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั (broadcast)

  

ะะผะตััะพ ะถะตััะบะธั ะดะฐั ะฒ ัะฐัะฟะธัะฐะฝะธะธ โ ะฐะดะผะธะฝ ะฒัััะฝัั ะพัะฟัะฐะฒะปัะตั ะฝะฐะฟะพะผะธะฝะฐะฝะธั:

  

|ะกะพะฑััะธะต|ะะพะผะฐะฝะดะฐ ะฐะดะผะธะฝะฐ|

|---|---|

|ะัะฐะบัะธะบะฐ: ะฟัะพะฒะตะดะตะฝะธะต ััะตะฝะธะฝะณะพะฒ|`/broadcast ะะฐะฟะพะผะธะฝะฐะตะผ: 2-8 ัะตะฒัะฐะปั โ ะฟัะฐะบัะธะบะฐ!`|

|ะััะปะฐะนะฝ ััะตะฝะธะฝะณ ะดะปั ะฝะพะฒะธัะบะพะฒ|`/broadcast 9 ัะตะฒัะฐะปั โ ะพััะปะฐะนะฝ ััะตะฝะธะฝะณ!`|

  

---

  

## 3. User Journey

  

### 3.1 ะะตัะฒัะน ะฒัะพะด ะธ ะฐะบัะธะฒะฐัะธั

  

```

/start

ย ย โ

ย ย โผ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ ยะกะพััะฐะฝะตะฝะธะต ัะทะตัะฐ ะฒ ะะ ย ย ย ย ยโ

โ ย(tg_id, username, created_at) ยโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ย ย โ

ย ย โผ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ ยะัะพะฒะตัะบะฐ ัะฐะฑะปะธัั enrollments ย โ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ย ย โ

ย ย โโโโ ะะตั ะดะพัััะฟะฐ โโโโบ ะะฐะณะปััะบะฐ + ะบะฝะพะฟะบะธ:

ย ย โ ย ย ย ย ย ย ย ย ย ย ยโข ยซะะฒะตััะธ ะบะพะด ะดะพัััะฟะฐยป

ย ย โ ย ย ย ย ย ย ย ย ย ย ยโข ยซะะฐะฟะธัะฐัั ะฒ ะฟะพะดะดะตัะถะบัยป

ย ย โ

ย ย โโโโ ะััั ะดะพัััะฟ โโโโบ ะะปะฐะฒะฝะพะต ะผะตะฝั

```

  

**ะะบัะธะฒะฐัะธั ะฟะพ ะบะพะดั:**

  

1. ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั ยซะะฒะตััะธ ะบะพะดยป

2. ะะพั: ยซะัะฟัะฐะฒััะต ะฒะฐั ะบะพะด ะดะพัััะฟะฐยป

3. ะัะพะฒะตัะบะฐ: ะบะพะด ัััะตััะฒัะตั? ะฝะต ะธัะฟะพะปัะทะพะฒะฐะฝ?

4. ะฃัะฟะตั โ ัะพะทะดะฐะตะผ `enrollment`, ะฟะพะผะตัะฐะตะผ ะบะพะด `used`

5. ะกะพะพะฑัะตะฝะธะต: ยซะะพัััะฟ ะพัะบััั! ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐััยป + ะบะฝะพะฟะบะฐ ยซะะฐัะฐัั ะฃัะพะบ 1ยป

  

### 3.2 ะัะพัะพะถะดะตะฝะธะต ััะพะบะพะฒ

  

**ะกัััะบัััะฐ ััะพะบะฐ:**

  

```

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ ย๐ ะฃัะพะบ N: {ะะฐะทะฒะฐะฝะธะต} ย ย ย ย ยโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค

โ ยะะฟะธัะฐะฝะธะต ััะพะบะฐ ย ย ย ย ย ย ย ย โ

โ ย๐ฅ ะะธะดะตะพ (ัััะปะบะฐ) ย ย ย ย ย ย ยโ

โ ย๐ ะขะตะบัั ะทะฐะดะฐะฝะธั (ะตัะปะธ ะตััั) ย โ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค

โ ย[ะะฝะพะฟะบะธ ะดะตะนััะฒะธะน] ย ย ย ย ย ย ยโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

```

  

**ะะฒะฐ ัะธะฟะฐ ััะพะบะพะฒ:**

  

|ะขะธะฟ|ะะฝะพะฟะบะธ|ะะพะณะธะบะฐ|

|---|---|---|

|ะก ะะ|ยซะกะดะฐัั ะะยป, ยซะะพะฟัะพั ะบััะฐัะพััยป|ะขัะตะฑัะตั ัะดะฐัะธ ะดะปั ะฟัะพะณัะตััะฐ|

|ะะตะท ะะ|ยซะะฐัะตัะธะฐะป ะธะทััะตะฝ โยป|ะะณะฝะพะฒะตะฝะฝัะน `COMPLETED`|

  

### 3.3 ะกะดะฐัะฐ ะะ ั AI-ะะตะฝัะพัะพะผ

  

```

ะะฐะถะฐัะธะต ยซะกะดะฐัั ะะยป

ย ย โ

ย ย โผ

FSM State: WAITING_HW

ะะพั: ยซะะฐะฟะธัะธัะต ะพัะฒะตั ัะตะบััะพะผ ะธะปะธ ะฟัะธะบัะตะฟะธัะต ัะฐะนะป/ัััะปะบัยป

ย ย โ

ย ย โผ

ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั ะพัะฒะตั

ย ย โ

ย ย โโโโ ะะพะปะพัะพะฒะพะต? โโโโบ ยซะะทะฒะธะฝะธัะต, ะฟัะธะฝะธะผะฐะตะผ ัะพะปัะบะพ ัะตะบัั ะธะปะธ ัะฐะนะปัยป

ย ย โ

ย ย โโโโ ะขะตะบัั < 20 ัะธะผะฒะพะปะพะฒ? โโโโบ ยซะกะปะธัะบะพะผ ะบะพัะพัะบะธะน ะพัะฒะตั, ะฝะฐะฟะธัะธัะต ะฟะพะดัะพะฑะฝะตะตยป

ย ย โ

ย ย โโโโ ะคะฐะนะป ะฝะตะฒะตัะฝะพะณะพ ัะพัะผะฐัะฐ? โโโโบ ยซะัะธะฝะธะผะฐะตะผ ัะพะปัะบะพ PDF ะธะปะธ DOCX.

ย ย โ ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ะะพะถะฐะปัะนััะฐ, ะฟัะธะบัะตะฟะธัะต ัะฐะนะป ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ัะพัะผะฐัะตยป

ย ย โ

ย ย โโโโ ะะธะดะตะพ-ัััะปะบะฐ ะฝะต YouTube? โโโโบ ยซะะพะถะฐะปัะนััะฐ, ะพัะฟัะฐะฒััะต ัััะปะบั ะฝะฐ YouTubeยป

ย ย โ

ย ย โโโโ ะัั ะะ โโโโบ FSM: PROCESSING

ย ย ย ย ย ย ย ย ย ย ยะะพั: ยซะัะธะฝััะพ, ะฟัะพะฒะตััั...ยป

ย ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ยโผ

ย ย ย ย ย ย ย โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ย ย ย ย ย ย ย โ ยะขะธะฟ ััะพะบะฐ? ย ย ย ย ย ย ย ย โ

ย ย ย ย ย ย ย โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ย ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย โโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโ

ย ย ย ย โ ย ย ย ย ย ย ย ยโ ย ย ย ย ย ย ย ยโ

ย ย ะขะะะกะขะะะซะ ย ย ยะคะะะ/ะะะะะ ย ย ยะะะ ะะ

ย ย ย ย โ ย ย ย ย ย ย ย ยโ ย ย ย ย ย ย ย ยโ

ย ย ย ย โผ ย ย ย ย ย ย ย ยโผ ย ย ย ย ย ย ย ยโผ

ย ยLLM-ะฟัะพะฒะตัะบะฐ ย ยะะฐะฝะดะพะผะฝะพะต ย ย ย ย ะกัะฐะทั

ย ย+ ัะธะดะฑัะบ ย ย ย ยัะพะพะฑัะตะฝะธะต ย ย ย ยCOMPLETED

ย ย ย ย ย ย ย ย ย ย"ะัะปะธัะฝะพ!"

```

  

### 3.4 ะะพะดะดะตัะถะบะฐ (ะัะพะบัะธ-ัะตะถะธะผ)

  

```

ยซะะฐะดะฐัั ะฒะพะฟัะพั ะบััะฐัะพััยป

ย ย โ

ย ย โผ

ะะพั: ยซะะฐะฟะธัะธัะต ะฒะฐั ะฒะพะฟัะพั ัะปะตะดัััะธะผ ัะพะพะฑัะตะฝะธะตะผยป

ย ย โ

ย ย โผ

ะะตัะตััะปะบะฐ ะบััะฐัะพัั (ะปะธัะฝะพะต ัะพะพะฑัะตะฝะธะต):

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ ๐ค User: @username (ID: 123) ย ยโ

โ ะฃัะพะบ: 5 ย ย ย ย ย ย ย ย ย ย ย ย โ

โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ

โ {ะขะตะบัั ะฒะพะฟัะพัะฐ ะฟะพะปัะทะพะฒะฐัะตะปั} ย ยโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ย ย โ

ย ย โผ

ะััะฐัะพั ะดะตะปะฐะตั Reply โ ะะพั ะฟะตัะตััะปะฐะตั ะพัะฒะตั ะฟะพะปัะทะพะฒะฐัะตะปั

```

  

---

  

## 4. Must-Have ััะฝะบัะธะธ

  

### ะัะธัะธัะตัะบะธะต (ะฑะตะท ะฝะธั ะฝะต ะทะฐะฟััะบะฐะตะผัั)

  

|#|ะคัะฝะบัะธั|ะัะธะพัะธัะตั|ะะตัะฐะปะธ|

|---|---|---|---|

|1|ะะบัะธะฒะฐัะธั ะฟะพ ะบะพะดั ะดะพัััะฟะฐ|๐ด P0|ะะดะฝะพัะฐะทะพะฒัะต ะบะพะดั|

|2|ะัะพัะผะพัั ััะพะบะฐ (ัะตะบัั + ะฒะธะดะตะพ YouTube)|๐ด P0|18 ััะพะบะพะฒ|

|3|ะกะดะฐัะฐ ะะ (ัะตะบัั/ัะฐะนะป/ัััะปะบะฐ)|๐ด P0|ะะฐะทะฝัะต ัะพัะผะฐัั ะดะปั ัะฐะทะฝัั ััะพะบะพะฒ|

|4|AI-ะฟัะพะฒะตัะบะฐ ะฝะฐ ะผััะพั/ัะฟะฐะผ|๐ด P0|gpt-4o-mini|

|5|AI-ัะธะดะฑัะบ (ะฟะตััะพะฝะฐะปะธะทะธัะพะฒะฐะฝะฝะฐั ะฟะพัะฒะฐะปะฐ)|๐ด P0|ะขะตะฟะปัะน ัะพะฝ|

|6|ะัะบัััะธะต ััะพะบะพะฒ (ะะ ัะดะฐะฝะพ + 1 ะดะตะฝั)|๐ด P0|Gating + delay|

|7|ะัะพะบัะธ-ะฟะพะดะดะตัะถะบะฐ (ะพะดะธะฝ ะบััะฐัะพั)|๐ด P0|Reply โ ะฟะตัะตััะปะบะฐ|

|8|FSM ะดะปั ะทะฐัะธัั ะพั ะดะฒะพะนะฝัั ะบะปะธะบะพะฒ|๐ด P0|ะกะพััะพัะฝะธั ะฒ ะะ|

|9|**Rate limiting: 7 ัะพะพะฑัะตะฝะธะน/ัะฐั**|๐ด P0|ะะฝัะธัะฟะฐะผ ะฟัะธ ัะดะฐัะต ะะ|

  

### ะะฐะถะฝัะต (ะฝัะถะฝั ะดะปั ััะฐะฑะธะปัะฝะพััะธ)

  

|#|ะคัะฝะบัะธั|ะัะธะพัะธัะตั|ะะตัะฐะปะธ|

|---|---|---|---|

|10|Fallback ะฟัะธ ัะฑะพะต LLM|๐ก P1|ะะฐััะธััะฒะฐะตะผ ะตัะปะธ ัะตะบัั > 20 ัะธะผะฒะพะปะพะฒ|

|11|ะะดะผะธะฝ-ะบะพะผะฐะฝะดั (/unlock_all, /force_accept)|๐ก P1|ะญะบัััะตะฝะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต|

|12|ะะถะตะดะฝะตะฒะฝัะน ะฑัะบะฐะฟ ะะ|๐ก P1|pg_dump โ ะฐะดะผะธะฝั|

|13|ะะพะณะธัะพะฒะฐะฝะธะต ะฒะตัะดะธะบัะพะฒ AI|๐ก P1|ะะปั ะพัะปะฐะดะบะธ ะฟัะพะผะฟัะฐ|

|14|**ะะฐะฟะพะผะธะฝะฐะฝะธั ะฝะตะฐะบัะธะฒะฝัะผ**|๐ก P1|ะงะตัะตะท 3 ะธ 7 ะดะฝะตะน ะฑะตะท ะฐะบัะธะฒะฝะพััะธ|

  

### Nice-to-have (ะฟะพัะปะต MVP)

  

|#|ะคัะฝะบัะธั|ะัะธะพัะธัะตั|

|---|---|---|

|15|ะกัะฐัะธััะธะบะฐ ะฟัะพะณัะตััะฐ ะดะปั ัะทะตัะฐ|๐ข P2|

|16|ะะตะฑ-ะฐะดะผะธะฝะบะฐ ะฒะผะตััะพ ะบะพะผะฐะฝะด|๐ข P2|

|17|ะกะตััะธัะธะบะฐั ะฟะพ ะพะบะพะฝัะฐะฝะธะธ ะบัััะฐ|๐ข P2|

  

---

  

## 5. ะขะตัะฝะธัะตัะบะฐั ะฐััะธัะตะบัััะฐ

  

### 5.1 State Machine (FSM)

  

```

โโโโโโโโโโโโ ย ย/start ย ย โโโโโโโโโโโโ

โ ยSTART ย โ โโโโโโโโโโโโโบ โ NO_AUTH ยโ

โโโโโโโโโโโโ ย ย ย ย ย ย ย โโโโโโโโโโโโ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ

ย ย ย ย ย ย ย ย ย ย ย ย ย ะะฒะพะด ะบะพะดะฐ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โผ

ย ย ย ย ย ย ย ย ย ย ย ย ย ยโโโโโโโโโโโโ

ย ย ย ย ย ย ย ย ย ย ย ย ย ยโ ย IDLE ย โ โโโโโโโโโโโโโโโโโโ

ย ย ย ย ย ย ย ย ย ย ย ย ย ยโโโโโโโโโโโโ ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ยะะฐะถะฐัะธะต ยซะกะดะฐัั ะะยป ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โผ ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ย โโโโโโโโโโโโโโ ย ย ย ย ย ย ย ย โ

ย ย ย ย ย ย ย ย ย ย ย ย ย โ WAITING_HW โ ย ย ย ย ย ย ย ย โ

ย ย ย ย ย ย ย ย ย ย ย ย ย โโโโโโโโโโโโโโ ย ย ย ย ย ย ย ย โ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ยะัะฟัะฐะฒะบะฐ ะพัะฒะตัะฐ ย ย ย ย ย ย ย ย ย โ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โ ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย โผ ย ย ย ย ย ย ย ย ย ย ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ย โโโโโโโโโโโโโโ ย ยะัะฒะตั LLM ย ยโ

ย ย ย ย ย ย ย ย ย ย ย ย ย โ PROCESSING โ โโโโโโโโโโโโโโโโโ

ย ย ย ย ย ย ย ย ย ย ย ย ย โโโโโโโโโโโโโโ

```

  

**ะัะฐะฒะธะปะฐ ะธะดะตะผะฟะพัะตะฝัะฝะพััะธ:**

  

- ะะฝะพะฟะบะฐ ะพั ะฟัะพัะปะพะณะพ ััะพะบะฐ โ `callback.answer("ะฃัะพะบ ัะถะต ะฟัะพะนะดะตะฝ")`

- ะะฒะพะนะฝะพะต ะฝะฐะถะฐัะธะต โ ะพะฑัะฐะฑะฐััะฒะฐะตััั ัะพะปัะบะพ ะฟะตัะฒะพะต

- ะ ัะพััะพัะฝะธะธ `PROCESSING` ะฑะปะพะบะธััะตะผ ะฒะฒะพะด

  

### 5.2 ะะฐัะฟะธัะฐะฝะธะต ะพัะบัััะธั ััะพะบะพะฒ (ะฃะะะะฉะะะะะฏ ะะะะะะ)

  

```python

# ะะพะณะธะบะฐ ะพัะบัััะธั ััะพะบะฐ

async def check_lesson_unlock(user_id: int):

ย ย user = await db.get_user(user_id)

ย ย current_lesson = await db.get_current_lesson(user_id)

ย ย # ะััั ะทะฐะฒะตััะตะฝ?

ย ย if current_lesson.order_num >= 18:

ย ย ย ย return

ย ย # ะัะตะดัะดััะธะน ััะพะบ ะทะฐะฒะตััะตะฝ?

ย ย if current_lesson.status != 'COMPLETED':

ย ย ย ย return

ย ย # ะัะพัะตะป 1 ะดะตะฝั ั ะผะพะผะตะฝัะฐ ะทะฐะฒะตััะตะฝะธั?

ย ย time_since_completion = datetime.now() - current_lesson.completed_at

ย ย if time_since_completion < timedelta(days=1):

ย ย ย ย return

ย ย # ะัะบััะฒะฐะตะผ ัะปะตะดัััะธะน ััะพะบ!

ย ย next_lesson = await db.get_lesson(current_lesson.order_num + 1)

ย ย await db.unlock_lesson(user_id, next_lesson.id)

ย ย # ะัะฟัะฐะฒะปัะตะผ ัะฒะตะดะพะผะปะตะฝะธะต

ย ย await bot.send_message(

ย ย ย ย user_id,

ย ย ย ย f"๐ ะัะบััะปัั ะฃัะพะบ {next_lesson.order_num}: {next_lesson.title}!\n\n"

ย ย ย ย f"ะะฐะถะผะธ ะบะฝะพะฟะบั ะฝะธะถะต, ััะพะฑั ะฝะฐัะฐัั.",

ย ย ย ย reply_markup=lesson_keyboard(next_lesson)

ย ย )

```

  

**ะะพะณะดะฐ ะฟัะพะฒะตััะตะผ ะพัะบัััะธะต:**

  

1. **ะกัะฐะทั ะฟะพัะปะต ัะดะฐัะธ ะะ** โ ะตัะปะธ ะฟัะพัะปะพ 24+ ัะฐัะฐ ั ะฟัะพัะปะพะณะพ ััะพะบะฐ

2. **ะะถะตะดะฝะตะฒะฝะพ ะฒ 10:00** โ ะดะปั ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน (job ะฒ APScheduler)

  

**ะัะธะผะตั:**

  

```

ะกััะดะตะฝั ะ (ะฑัััััะน):

โโ 12.01 ะฒ 10:00 โ ะะพะปััะธะป ะฃัะพะบ 1

โโ 12.01 ะฒ 18:00 โ ะกะดะฐะป ะะ

โโ 13.01 ะฒ 10:00 โ Job ะพัะบััะฒะฐะตั ะฃัะพะบ 2

โโ 13.01 ะฒ 12:00 โ ะกะดะฐะป ะะ

โโ 14.01 ะฒ 10:00 โ Job ะพัะบััะฒะฐะตั ะฃัะพะบ 3

โโ ... (ะธะดะตะฐะปัะฝัะน ัะตะผะฟ)

  

ะกััะดะตะฝั ะ (ะผะตะดะปะตะฝะฝัะน):

โโ 12.01 โ ะะพะปััะธะป ะฃัะพะบ 1

โโ 20.01 โ ะกะดะฐะป ะะ (ัะตัะตะท 8 ะดะฝะตะน)

โโ 21.01 โ ะฃัะพะบ 2 ะพัะบััั

โโ ... (ัะฒะพะน ัะตะผะฟ)

```

  

### 5.3 Rate Limiting (ะะฝัะธัะฟะฐะผ)

  

```python

# ะะณัะฐะฝะธัะตะฝะธะต: 7 ัะพะพะฑัะตะฝะธะน ะฒ ัะฐั ะฝะฐ ัะดะฐัั ะะ

RATE_LIMIT = 7

RATE_WINDOW = 3600 ย# 1 ัะฐั ะฒ ัะตะบัะฝะดะฐั

  

async def check_rate_limit(user_id: int, lesson_id: int) -> bool:

ย ย """

ย ย ะัะพะฒะตััะตั, ะฝะต ะฟัะตะฒััะธะป ะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะปะธะผะธั ะฟะพะฟััะพะบ.

ย ย ะะพะทะฒัะฐัะฐะตั True ะตัะปะธ ะผะพะถะฝะพ ะพัะฟัะฐะฒะธัั, False ะตัะปะธ ะปะธะผะธั ะธััะตัะฟะฐะฝ.

ย ย """

ย ย key = f"hw_attempts:{user_id}:{lesson_id}"

ย ย # ะกัะธัะฐะตะผ ะฟะพะฟััะบะธ ะทะฐ ะฟะพัะปะตะดะฝะธะน ัะฐั

ย ย recent_attempts = await db.count_submissions(

ย ย ย ย user_id=user_id,

ย ย ย ย lesson_id=lesson_id,

ย ย ย ย since=datetime.now() - timedelta(hours=1)

ย ย )

ย ย if recent_attempts >= RATE_LIMIT:

ย ย ย ย return False

ย ย return True

  

# ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฒ ัะตะฝะดะปะตัะต

async def handle_homework_submission(update, context):

ย ย user_id = update.effective_user.id

ย ย lesson_id = context.user_data['current_lesson']

ย ย # ะัะพะฒะตัะบะฐ ะปะธะผะธัะฐ

ย ย if not await check_rate_limit(user_id, lesson_id):

ย ย ย ย remaining_time = get_time_until_reset(user_id, lesson_id)

ย ย ย ย await update.message.reply_text(

ย ย ย ย ย ย f"โณ ะั ะพัะฟัะฐะฒะธะปะธ ัะปะธัะบะพะผ ะผะฝะพะณะพ ัะพะพะฑัะตะฝะธะน.\n"

ย ย ย ย ย ย f"ะะพะฟัะพะฑัะนัะต ัะตัะตะท {remaining_time} ะผะธะฝัั."

ย ย ย ย )

ย ย ย ย return

ย ย # ะัะพะดะพะปะถะฐะตะผ ะพะฑัะฐะฑะพัะบั...

```

  

### 5.4 ะะฐะฟะพะผะธะฝะฐะฝะธั ะฝะตะฐะบัะธะฒะฝัะผ ัััะดะตะฝัะฐะผ

  

```python

# ะะฐัะฟะธัะฐะฝะธะต ะฝะฐะฟะพะผะธะฝะฐะฝะธะน

REMINDER_SCHEDULE = [

ย ย {"days": 3, "message": "๐ ะัะธะฒะตั! ะขั ะฝะต ะทะฐัะพะดะธะป ัะถะต 3 ะดะฝั. ะฃัะพะบ {lesson} ะถะดะตั ัะตะฑั!"},

ย ย {"days": 7, "message": "๐ ะัะพัะปะฐ ะฝะตะดะตะปั ั ัะฒะพะตะณะพ ะฟะพัะปะตะดะฝะตะณะพ ะฒะธะทะธัะฐ. ะะต ะทะฐะฑัะฐััะฒะฐะน ะบััั โ ะพััะฐะปะพัั ะฒัะตะณะพ {remaining} ััะพะบะพะฒ!"},

]

  

async def send_reminders():

ย ย """Job: ะทะฐะฟััะบะฐะตััั ะตะถะตะดะฝะตะฒะฝะพ ะฒ 18:00"""

ย ย inactive_users = await db.get_inactive_users()

ย ย for user in inactive_users:

ย ย ย ย days_inactive = (now() - user.last_activity).days

ย ย ย ย for reminder in REMINDER_SCHEDULE:

ย ย ย ย ย ย if days_inactive == reminder["days"]:

ย ย ย ย ย ย ย ย message = reminder["message"].format(

ย ย ย ย ย ย ย ย ย ย lesson=user.current_lesson.title,

ย ย ย ย ย ย ย ย ย ย remaining=18 - user.current_lesson.order

ย ย ย ย ย ย ย ย )

ย ย ย ย ย ย ย ย try:

ย ย ย ย ย ย ย ย ย ย await bot.send_message(user.tg_id, message)

ย ย ย ย ย ย ย ย ย ย await db.log_reminder(user.tg_id, days_inactive)

ย ย ย ย ย ย ย ย except TelegramError:

ย ย ย ย ย ย ย ย ย ย # ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะฑะปะพะบะธัะพะฒะฐะป ะฑะพัะฐ

ย ย ย ย ย ย ย ย ย ย pass

```

  

**ะะพะณะธะบะฐ:**

  

- ะะฐะฟะพะผะธะฝะฐะฝะธะต ัะตัะตะท **3 ะดะฝั** โ ะผัะณะบะพะต

- ะะฐะฟะพะผะธะฝะฐะฝะธะต ัะตัะตะท **7 ะดะฝะตะน** โ ะฑะพะปะตะต ะฝะฐััะพะนัะธะฒะพะต

- ะะพัะปะต 14 ะดะฝะตะน โ ะฝะต ัะฟะฐะผะธะผ, ััะธัะฐะตะผ "ะทะฐะฑัะพัะตะฝะฝัะผ"

  

### 5.5 ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ (Safety)

  

|ะกะธััะฐัะธั|ะะตัะตะฝะธะต|

|---|---|

|LLM ะฝะต ะพัะฒะตัะธะปะฐ ะทะฐ 15 ัะตะบ|ะะฐััะธััะฒะฐะตะผ ััะพะบ + ะทะฐะณะปััะบะฐ ยซะัะปะธัะฝะฐั ัะฐะฑะพัะฐ! โยป|

|LLM ะฒะตัะฝัะปะฐ ะฝะตะฒะฐะปะธะดะฝัะน JSON|Fallback: ะทะฐััะธััะฒะฐะตะผ ะตัะปะธ ัะตะบัั > 20 ัะธะผะฒะพะปะพะฒ|

|ะะดะธะฝ ัะทะตั ะทะฐะฑะปะพะบะธัะพะฒะฐะป ะฑะพัะฐ|`try-except` ะฒ ัะธะบะปะต ัะฐัััะปะบะธ, ะพััะฐะปัะฝัะต ะฟะพะปััะฐัั|

|ะะ ะฝะตะดะพัััะฟะฝะฐ|Retry ั exponential backoff|

  

### 5.6 ะะตะทะตัะฒะฝะพะต ะบะพะฟะธัะพะฒะฐะฝะธะต

  

```bash

# Cron job (ะตะถะตะดะฝะตะฒะฝะพ ะฒ 03:00)

0 3 * * * pg_dump -U postgres course_bot > /backups/backup_$(date +\%Y\%m\%d).sql

  

# ะะพั ะพัะฟัะฐะฒะปัะตั ัะฐะนะป ะฐะดะผะธะฝั

```

  

---

  

## 6. ะะฐะทะฐ ะดะฐะฝะฝัั

  

### 6.1 ER-ะดะธะฐะณัะฐะผะผะฐ

  

```

โโโโโโโโโโโโโโโ ย ย ย โโโโโโโโโโโโโโโโ ย ย ย โโโโโโโโโโโโโโโ

โ ย users ย ย โ ย ย ย โ ยenrollments โ ย ย ย โ ย lessons ย โ

โโโโโโโโโโโโโโโค ย ย ย โโโโโโโโโโโโโโโโค ย ย ย โโโโโโโโโโโโโโโค

โ tg_id (PK) ยโโโโโโโโโ user_id (FK) โ ย ย ย โ id (PK) ย ย โ

โ username ย ยโ ย ย ย โ start_date ย โ ย ย ย โ order_num ย โ

โ full_name ย โ ย ย ย โ curr_lesson ยโโโโโโโโโ title ย ย ย โ

โ created_at ยโ ย ย ย โโโโโโโโโโโโโโโโ ย ย ย โ content ย ย โ

โ state (FSM) โ ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยโ video_url ย โ

โ last_active โ ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยโ has_homeworkโ

โโโโโโโโโโโโโโโ ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยโ hw_type ย ย โ

ย ย ย โ ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยโโโโโโโโโโโโโโโ

ย ย ย โ ย ย ย ย โโโโโโโโโโโโโโโโโ ย ย ย ย ย ย ย ย ย โ

ย ย ย โ ย ย ย ย โ user_progress โ ย ย ย ย ย ย ย ย ย โ

ย ย ย โ ย ย ย ย โโโโโโโโโโโโโโโโโค ย ย ย ย ย ย ย ย ย โ

ย ย ย โโโโโโโโโโบโ user_id (FK) ยโโโโโโโโโโโโโโโโโโโโโ

ย ย ย ย ย ย ย ย โ lesson_id (FK)โ

ย ย ย ย ย ย ย ย โ status ย ย ย ยโ

ย ย ย ย ย ย ย ย โ completed_at ยโ

ย ย ย ย ย ย ย ย โโโโโโโโโโโโโโโโโ

  

โโโโโโโโโโโโโโโโ ย ย ย โโโโโโโโโโโโโโโโ ย ย ย โโโโโโโโโโโโโโโโ

โ submissions ยโ ย ย ย โ access_codes โ ย ย ย โ ยreminders ย โ

โโโโโโโโโโโโโโโโค ย ย ย โโโโโโโโโโโโโโโโค ย ย ย โโโโโโโโโโโโโโโโค

โ id (PK) ย ย ยโ ย ย ย โ code (PK) ย ยโ ย ย ย โ id (PK) ย ย ยโ

โ user_id (FK) โ ย ย ย โ is_used ย ย ยโ ย ย ย โ user_id (FK) โ

โ lesson_id ย ยโ ย ย ย โ created_at ย โ ย ย ย โ sent_at ย ย ยโ

โ content_text โ ย ย ย โโโโโโโโโโโโโโโโ ย ย ย โ type (3d/7d) โ

โ ai_verdict ย โ ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยโโโโโโโโโโโโโโโโ

โ ai_message ย โ

โ created_at ย โ

โโโโโโโโโโโโโโโโ

```

  

### 6.2 SQL-ััะตะผะฐ

  

```sql

-- ะะพะปัะทะพะฒะฐัะตะปะธ

CREATE TABLE users (

ย ย tg_id BIGINT PRIMARY KEY,

ย ย username VARCHAR(255),

ย ย full_name VARCHAR(255),

ย ย created_at TIMESTAMP DEFAULT NOW(),

ย ย state VARCHAR(50) DEFAULT 'NO_AUTH',

ย ย last_activity TIMESTAMP DEFAULT NOW() ย-- ะะปั ะฝะฐะฟะพะผะธะฝะฐะฝะธะน

);

  

-- ะฃัะพะบะธ (ะทะฐะฟะพะปะฝัะตััั ะธะท Excel)

CREATE TABLE lessons (

ย ย id SERIAL PRIMARY KEY,

ย ย order_num INT UNIQUE NOT NULL, ย-- 1, 2, 3... 18

ย ย title VARCHAR(255) NOT NULL,

ย ย content_text TEXT, ย-- ะขะตะบัั ะทะฐะดะฐะฝะธั

ย ย video_url VARCHAR(500), ย-- YouTube ัััะปะบะฐ

ย ย has_homework BOOLEAN DEFAULT TRUE,

ย ย homework_type VARCHAR(20) DEFAULT 'text' ย-- text, video_link, file

);

  

-- ะะฐัะธัะปะตะฝะธั (ัะฒัะทั ัะทะตั-ะบััั)

CREATE TABLE enrollments (

ย ย id SERIAL PRIMARY KEY,

ย ย user_id BIGINT REFERENCES users(tg_id),

ย ย start_date TIMESTAMP DEFAULT NOW(),

ย ย current_lesson_id INT REFERENCES lessons(id) DEFAULT 1,

ย ย UNIQUE(user_id)

);

  

-- ะัะพะณัะตัั ะฟะพ ััะพะบะฐะผ

CREATE TABLE user_progress (

ย ย id SERIAL PRIMARY KEY,

ย ย user_id BIGINT REFERENCES users(tg_id),

ย ย lesson_id INT REFERENCES lessons(id),

ย ย status VARCHAR(20) DEFAULT 'LOCKED', ย-- LOCKED, OPEN, COMPLETED

ย ย completed_at TIMESTAMP,

ย ย UNIQUE(user_id, lesson_id)

);

  

-- ะกะดะฐะฝะฝัะต ัะฐะฑะพัั (ะปะพะณ + rate limiting)

CREATE TABLE submissions (

ย ย id SERIAL PRIMARY KEY,

ย ย user_id BIGINT REFERENCES users(tg_id),

ย ย lesson_id INT REFERENCES lessons(id),

ย ย content_text TEXT,

ย ย content_type VARCHAR(20), ย-- text, file, video_link

ย ย ai_verdict VARCHAR(20), ย-- ACCEPT, REVISE

ย ย ai_message TEXT,

ย ย created_at TIMESTAMP DEFAULT NOW()

);

  

-- ะะพะดั ะดะพัััะฟะฐ

CREATE TABLE access_codes (

ย ย code VARCHAR(50) PRIMARY KEY,

ย ย is_used BOOLEAN DEFAULT FALSE,

ย ย used_by BIGINT REFERENCES users(tg_id),

ย ย created_at TIMESTAMP DEFAULT NOW()

);

  

-- ะะพะณ ะฝะฐะฟะพะผะธะฝะฐะฝะธะน (ััะพะฑั ะฝะต ัะฟะฐะผะธัั)

CREATE TABLE reminders (

ย ย id SERIAL PRIMARY KEY,

ย ย user_id BIGINT REFERENCES users(tg_id),

ย ย reminder_type VARCHAR(10), ย-- '3_days', '7_days'

ย ย sent_at TIMESTAMP DEFAULT NOW()

);

  

-- ะะฝะดะตะบัั

CREATE INDEX idx_progress_user ON user_progress(user_id);

CREATE INDEX idx_submissions_user_lesson ON submissions(user_id, lesson_id);

CREATE INDEX idx_submissions_created ON submissions(created_at); ย-- ะะปั rate limiting

CREATE INDEX idx_codes_unused ON access_codes(is_used) WHERE is_used = FALSE;

CREATE INDEX idx_users_last_activity ON users(last_activity); ย-- ะะปั ะฟะพะธัะบะฐ ะฝะตะฐะบัะธะฒะฝัั

  

-- ะคัะฝะบัะธั ะดะปั rate limiting

CREATE OR REPLACE FUNCTION count_recent_submissions(

ย ย p_user_id BIGINT,

ย ย p_lesson_id INT,

ย ย p_hours INT DEFAULT 1

) RETURNS INT AS $$

BEGIN

ย ย RETURN (

ย ย ย ย SELECT COUNT(*)

ย ย ย ย FROM submissions

ย ย ย ย WHERE user_id = p_user_id

ย ย ย ย ย AND lesson_id = p_lesson_id

ย ย ย ย ย AND created_at > NOW() - INTERVAL '1 hour' * p_hours

ย ย );

END;

$$ LANGUAGE plpgsql;

```

  

### 6.3 ะะฐะฝะฝัะต ััะพะบะพะฒ (INSERT)

  

```sql

-- ะะฐะณััะทะบะฐ ััะพะบะพะฒ (ะธัะฟัะฐะฒะปะตะฝะฝะฐั ะฝัะผะตัะฐัะธั 1-18)

INSERT INTO lessons (order_num, title, has_homework, homework_type, video_url) VALUES

(1, ย'ะงัะพ ะตััั ััะตะฝะธะฝะณ?', TRUE, 'text', 'https://youtu.be/wERSPxhPqXg'),

(2, ย'ะกะฟะพัะพะฑั ะฟะตัะตะดะฐัะธ ะทะฝะฐะฝะธะน', TRUE, 'text', 'https://youtu.be/h5maY1xalH4'),

(3, ย'ะัะพะฑะตะฝะฝะพััะธ ะพะฑััะตะฝะธั ะฒะทัะพัะปัั', TRUE, 'text', 'https://youtu.be/j4DsZ-2WT6U'),

(4, ย'ะฆะธะบะป ะะพะปะฑะฐ ะฝะฐ ะฟัะฐะบัะธะบะต', TRUE, 'video_link', 'https://youtu.be/qXtR2rbLP_E'),

(5, ย'ะะตัะพะดั ัะฐะฑะพัั ั ะณััะฟะฟะพะน', TRUE, 'text', 'https://youtu.be/okHIGqNYWZQ'),

(6, ย'ะกะตะทะพะฝะฝะพััั: ะะตัะฝะฐ', TRUE, 'text', 'https://youtu.be/otgThzHjWBY'),

(7, ย'ะกะตะทะพะฝะฝะพััั: ะะตัะพ', TRUE, 'text', 'https://youtu.be/3crwHSV8ar8'),

(8, ย'ะกะตะทะพะฝะฝะพััั: ะัะตะฝั', FALSE, NULL, 'https://youtu.be/cbaWx59WTTQ'),

(9, ย'ะกะตะทะพะฝะฝะพััั: ะะธะผะฐ', TRUE, 'video_link', 'https://youtu.be/UfSAL5mTWJ4'),

(10, 'ะััะฟะฟะพะฒะฐั ะดะธะฝะฐะผะธะบะฐ', TRUE, 'text', 'https://youtu.be/P0mf-Gqsyuc'),

(11, 'ะฆะธะบะป ะะพะปะฑะฐ: ัะพัะผะธัะพะฒะฐะฝะธะต ะฝะฐะฒัะบะฐ', TRUE, 'file', 'https://youtu.be/YNuqggee1hI'),

(12, 'ะะตัะปะตะพะฑัะฐะทะฝะพะต ัะฐะทะฒะธัะธะต', TRUE, 'text', 'https://youtu.be/aFyub7ji1v8'),

(13, 'ะะธัะฐะผะธะดะฐ ะพะฑััะตะฝะธั', TRUE, 'text', 'https://youtu.be/jfQx05gSqI8'),

(14, 'ะะฐััะธัะฐ ะพัะพะทะฝะฐะฝะฝะพััะธ', TRUE, 'text', 'https://youtu.be/80dx8YJf6Ms'),

(15, 'ะะพะฝั ัะฐะทะฒะธัะธั ะฟะพ ะัะณะพััะบะพะผั', TRUE, 'text', 'https://youtu.be/-crlu_B44d8'),

(16, 'ะฆะฒะตัะพะฒะพะน ะฟัะพัะธะปั ััะตะฝะตัะฐ', TRUE, 'text', 'https://youtu.be/iIxARBNwpsk'),

(17, 'ะฃะฝะธะบะฐะปัะฝัะน ััะธะปั ัะตัะตะท ัะตะฝะฝะพััะธ', TRUE, 'text', 'https://youtu.be/k2aFgspqDnM'),

(18, 'ะะพะฝัั: ะกะธะฝะดัะพะผ ัะฐะผะพะทะฒะฐะฝัะฐ', FALSE, NULL, 'https://youtu.be/GpUNjX_7e4Y');

```

  

---

  

## 7. AI-ะะตะฝัะพั

  

### 7.1 ะะฒะฐ ัะตะถะธะผะฐ ะพัะฒะตัะพะฒ

  

|ะขะธะฟ ะะ|ะฃัะพะบะธ|ะัะพะฒะตัะบะฐ|ะัะฒะตั|

|---|---|---|---|

|**ะขะตะบัั**|1-3, 5-7, 10, 12-17|AI ะฐะฝะฐะปะธะทะธััะตั ัะพะดะตัะถะฐะฝะธะต|ะะตััะพะฝะฐะปะธะทะธัะพะฒะฐะฝะฝัะน ัะธะดะฑัะบ|

|**ะคะฐะนะป/ะะธะดะตะพ**|4, 9, 11|ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั|ะัะพััะพะต ะฟะพะดัะฒะตัะถะดะตะฝะธะต (ัะฐะฝะดะพะผ)|

|**ะะตะท ะะ**|8, 18|โ|ะะฝะพะฟะบะฐ ยซะะทััะตะฝะพยป|

  

### 7.2 System Prompt (ะดะปั ัะตะบััะพะฒัั ะะ)

  

```

ะขั โ ะฟะพะดะดะตัะถะธะฒะฐััะธะน ะธ ะผัะดััะน ะผะตะฝัะพั ะบัััะฐ "ะััะฐะฝะธะต ะขัะตะฝะตัะฐ".

ะขะฒะพั ะทะฐะดะฐัะฐ โ ะฟัะพะฒะตัะธัั ะพัะฒะตั ัััะดะตะฝัะฐ ะธ ะดะฐัั ะพะฑัะฐัะฝัั ัะฒัะทั.

  

ะะฅะะะะซะ ะะะะะซะ:

- ะะพะผะตั ััะพะบะฐ: {lesson_number}

- ะขะตะผะฐ ััะพะบะฐ: {lesson_topic} ย

- ะขะตะบัั ะทะฐะดะฐะฝะธั: {homework_task}

- ะัะฒะตั ัััะดะตะฝัะฐ: {user_answer}

  

ะะะะะะะขะ:

  

1. ะะะะะะะะ ะะ ะะะะะะะขะะะกะขะฌ:

ย ย- ะัะปะธ ััะพ ัะฟะฐะผ, ะฝะฐะฑะพั ะฑัะบะฒ, ะธะปะธ ะฟัััะฐั ะพัะฟะธัะบะฐ (ยซะพะบยป, ยซัะดะตะปะฐะปยป, ยซ.ยป) โ ะฒะตัะดะธะบั REVISE

ย ย- ะัะปะธ ะตััั ัะพัั ะบะฐะบะฐั-ัะพ ะพัะผััะปะตะฝะฝะฐั ะผััะปั ะฟะพ ัะตะผะต โ ะฒะตัะดะธะบั ACCEPT

  

2. ะะะะะะะฆะะฏ ะะขะะะขะ:

ย ยะัะปะธ ACCEPT:

ย ย- ะะฐะฟะธัะธ ะบะพัะพัะบะธะน (2-3 ะฟัะตะดะปะพะถะตะฝะธั) ะพะฑะพะดััััะธะน ะบะพะผะผะตะฝัะฐัะธะน

ย ย- ะะะฏะะะขะะะฌะะ ะฟะพัะฒะฐะปะธ ะทะฐ ะบะพะฝะบัะตัะฝัั ะดะตัะฐะปั ะธะท ะพัะฒะตัะฐ (ะฟะพะบะฐะถะธ, ััะพ ัั ะฟัะพัะธัะฐะป)

ย ย- ะัะฟะพะปัะทัะน ัะตะฟะปัะน, ะฟัะพัะตััะธะพะฝะฐะปัะฝัะน ัะพะฝ

ย ย- ะญะผะพะดะทะธ: ัะผะตัะตะฝะฝะพ (๐, ๐ฅ, โจ, ๐ช)

ย ย- ะะ ััะธ ะธ ะะ ะบัะธัะธะบัะน โ ัะพะปัะบะพ ะฟะพะดะดะตัะถะบะฐ

ย ยะัะปะธ REVISE:

ย ย- ะะตะถะปะธะฒะพ ะฟะพะฟัะพัะธ ะดะพะฟะพะปะฝะธัั ะพัะฒะตั

ย ย- ะะฑัััะฝะธ, ััะพ ะธะผะตะฝะฝะพ ะฝะต ัะฐะบ (ัะปะธัะบะพะผ ะบะพัะพัะบะพ / ะฝะต ะฟะพ ัะตะผะต)

ย ย- ะะพะดะฑะพะดัะธ ะฟะพะฟัะพะฑะพะฒะฐัั ะตัั ัะฐะท

  

ะคะะะะะข ะะซะะะะ (ัััะพะณะพ JSON):

{

ย "verdict": "ACCEPT" ะธะปะธ "REVISE",

ย "message": "ะขะฒะพะน ะบะพะผะผะตะฝัะฐัะธะน ะทะดะตัั"

}

```

  

### 7.3 ะัะพัััะต ะพัะฒะตัั (ะดะปั ัะฐะนะปะพะฒ ะธ ะฒะธะดะตะพ-ัััะปะพะบ)

  

ะะปั ััะพะบะพะฒ 4, 9, 11 โ AI ะะ ะฐะฝะฐะปะธะทะธััะตั ัะพะดะตัะถะธะผะพะต, ะฟัะพััะพ ะฟะพะดัะฒะตัะถะดะฐะตั.

  

```python

# ะะฐัะธะฐะฝัั ะพัะฒะตัะพะฒ ะดะปั "ะพัะตะปะพะฒะตัะธะฒะฐะฝะธั"

FILE_VIDEO_RESPONSES = [

ย ย "ะัะปะธัะฝะพ! ๐ฌ ะขะฒะพั ะดะพะผะฐัะฝะตะต ะทะฐะดะฐะฝะธะต ะฟัะธะฝััะพ. ะขะฐะบ ะดะตัะถะฐัั!",

ย ย "ะกัะฟะตั! โ ะะพะปััะธะป ัะฒะพั ัะฐะฑะพัั. ะะพะปะพะดะตั, ััะพ ะฒัะฟะพะปะฝะธะป!",

ย ย "ะัะธะฝััะพ! ๐ช ะะธะดะฝะพ, ััะพ ัั ััะฐัะฐะตัััั. ะัะพะดะพะปะถะฐะน ะฒ ัะพะผ ะถะต ะดััะต!",

ย ย "ะะปะฐัั! ๐ฅ ะะพะผะฐัะบะฐ ะทะฐััะตะฝะฐ. ะะฒะธะณะฐะตะผัั ะดะฐะปััะต!",

ย ย "ะะพะปััะธะป! โจ ะัะปะธัะฝะฐั ัะฐะฑะพัะฐ. ะขั ะฝะฐ ะฟัะฐะฒะธะปัะฝะพะผ ะฟััะธ!",

ย ย "ะะฐััะตะฝะพ! ๐ ะกะฟะฐัะธะฑะพ ะทะฐ ะฒัะฟะพะปะฝะตะฝะฝะพะต ะทะฐะดะฐะฝะธะต!",

ย ย "ะะพะปะพะดะตั! ๐ ะะฐะดะฐะฝะธะต ะฒัะฟะพะปะฝะตะฝะพ. ะัะพะดะพะปะถะฐะตะผ!",

]

  

# ะะพะฟัััะธะผัะต ัะพัะผะฐัั ัะฐะนะปะพะฒ

ALLOWED_FILE_EXTENSIONS = ['.pdf', '.docx']

ALLOWED_MIME_TYPES = [

ย ย 'application/pdf',

ย ย 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'

]

  

async def handle_file_video_submission(lesson: Lesson, content) -> dict:

ย ย """ะะฑัะฐะฑะพัะบะฐ ัะฐะนะปะพะฒ ะธ ะฒะธะดะตะพ-ัััะปะพะบ (ะฑะตะท AI)"""

ย ย # ะะปั ะฒะธะดะตะพ โ ะฟัะพะฒะตััะตะผ ััะพ ััะพ YouTube ัััะปะบะฐ

ย ย if lesson.homework_type == 'video_link':

ย ย ย ย if not is_youtube_link(content):

ย ย ย ย ย ย return {

ย ย ย ย ย ย ย ย "verdict": "REVISE",

ย ย ย ย ย ย ย ย "message": "ะะพะถะฐะปัะนััะฐ, ะฟัะธัะปะธ ัััะปะบั ะฝะฐ YouTube ะฒะธะดะตะพ ๐ฅ"

ย ย ย ย ย ย }

ย ย # ะะปั ัะฐะนะปะพะฒ โ ะฟัะพะฒะตััะตะผ ัะพัะผะฐั ะธ ัะฐะทะผะตั

ย ย if lesson.homework_type == 'file':

ย ย ย ย # ะัะพะฒะตัะบะฐ ัะพัะผะฐัะฐ

ย ย ย ย file_name = content.file_name.lower()

ย ย ย ย if not any(file_name.endswith(ext) for ext in ALLOWED_FILE_EXTENSIONS):

ย ย ย ย ย ย return {

ย ย ย ย ย ย ย ย "verdict": "REVISE",

ย ย ย ย ย ย ย ย "message": "๐ ะัะธะฝะธะผะฐะตะผ ัะพะปัะบะพ PDF ะธะปะธ DOCX ัะฐะนะปั.\nะะพะถะฐะปัะนััะฐ, ะฟัะธะบัะตะฟะธ ัะฐะนะป ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ัะพัะผะฐัะต."

ย ย ย ย ย ย }

ย ย ย ย # ะัะพะฒะตัะบะฐ ัะฐะทะผะตัะฐ (ะฝะต ะฟัััะพะน)

ย ย ย ย if content.file_size < 1024: ย# < 1KB

ย ย ย ย ย ย return {

ย ย ย ย ย ย ย ย "verdict": "REVISE",

ย ย ย ย ย ย ย ย "message": "ะะฐะถะตััั, ัะฐะนะป ะฟัััะพะน ะธะปะธ ัะปะธัะบะพะผ ะผะฐะปะตะฝัะบะธะน. ะะพะฟัะพะฑัะน ะตัั ัะฐะท ๐"

ย ย ย ย ย ย }

ย ย ย ย # ะัะพะฒะตัะบะฐ ะผะฐะบัะธะผะฐะปัะฝะพะณะพ ัะฐะทะผะตัะฐ (20MB)

ย ย ย ย if content.file_size > 20 * 1024 * 1024:

ย ย ย ย ย ย return {

ย ย ย ย ย ย ย ย "verdict": "REVISE",

ย ย ย ย ย ย ย ย "message": "ะคะฐะนะป ัะปะธัะบะพะผ ะฑะพะปััะพะน (ะผะฐะบัะธะผัะผ 20 ะะ). ะะพะฟัะพะฑัะน ัะถะฐัั ะตะณะพ ๐"

ย ย ย ย ย ย }

ย ย # ะัั ะพะบ โ ะฟัะธะฝะธะผะฐะตะผ ั ัะฐะฝะดะพะผะฝัะผ ะพัะฒะตัะพะผ

ย ย return {

ย ย ย ย "verdict": "ACCEPT",

ย ย ย ย "message": random.choice(FILE_VIDEO_RESPONSES)

ย ย }

  

def is_youtube_link(text: str) -> bool:

ย ย """ะัะพะฒะตัะบะฐ YouTube ัััะปะบะธ"""

ย ย patterns = [

ย ย ย ย r'youtube\.com/watch\?v=',

ย ย ย ย r'youtu\.be/',

ย ย ย ย r'youtube\.com/shorts/'

ย ย ]

ย ย return any(re.search(p, text) for p in patterns)

```

  

### 7.4 ะัะธะผะตัั ะพัะฒะตัะพะฒ AI (ัะตะบััะพะฒัะต ะะ)

  

**ะัะธะผะตั 1: ACCEPT**

  

```json

{

ย "verdict": "ACCEPT",

ย "message": "ะัะปะธัะฝะพ! ๐ฅ ะขั ะพัะตะฝั ัะพัะฝะพ ะพะฟะธัะฐะป ัะฒะพั ัะตะปะตะฒัั ะฐัะดะธัะพัะธั โ ะพัะพะฑะตะฝะฝะพ ะฟะพะฝัะฐะฒะธะปัั ะผะพะผะตะฝั ะฟัะพ ัััะฐัะธ ะบะปะธะตะฝัะพะฒ. ะะธะดะฝะพ, ััะพ ัั ะณะปัะฑะพะบะพ ะฟัะพะดัะผะฐะป ััั ัะตะผั. ะขะฐะบ ะดะตัะถะฐัั!"

}

```

  

**ะัะธะผะตั 2: REVISE (ะพัะฟะธัะบะฐ)**

  

```json

{

ย "verdict": "REVISE",

ย "message": "ะฅะผ, ะบะฐะถะตััั ะพัะฒะตั ะฟะพะปััะธะปัั ัะปะธัะบะพะผ ะบะพัะพัะบะธะผ ๐ค ะะพะฟัะพะฑัะน ัะฐัะฟะธัะฐัั ัะฒะพะธ ะผััะปะธ ะฟะพะดัะพะฑะฝะตะต โ ัะพัั ะฑั ะฟะฐัั ะฟัะตะดะปะพะถะตะฝะธะน ะพ ัะพะผ, ะบะฐะบ ัั ะฟะพะฝัะป ัะตะผั ััะพะบะฐ. ะฃ ัะตะฑั ัะพัะฝะพ ะฟะพะปััะธััั!"

}

```

  

**ะัะธะผะตั 3: REVISE (ะฝะต ะฟะพ ัะตะผะต)**

  

```json

{

ย "verdict": "REVISE",

ย "message": "ะกะฟะฐัะธะฑะพ ะทะฐ ะพัะฒะตั! ะะพ ะบะฐะถะตััั, ะพะฝ ะฝะต ัะพะฒัะตะผ ัะฒัะทะฐะฝ ั ัะตะผะพะน ััะพะบะฐ. ะะพะฟัะพะฑัะน ะตัั ัะฐะท, ะพะฟะธัะฐััั ะฝะฐ ะทะฐะดะฐะฝะธะต. ะัะปะธ ััะพ-ัะพ ะฝะตะฟะพะฝััะฝะพ โ ะฝะฐะถะผะธ ยซะะพะฟัะพั ะบััะฐัะพััยป ๐ฌ"

}

```

  

### 7.3 ะะฐัะฐะผะตััั ะฒัะทะพะฒะฐ LLM

  

```python

response = openai.chat.completions.create(

ย ย model="gpt-4o-mini",

ย ย messages=[

ย ย ย ย {"role": "system", "content": SYSTEM_PROMPT},

ย ย ย ย {"role": "user", "content": f"ะฃัะพะบ {n}: {topic}\nะะฐะดะฐะฝะธะต: {task}\nะัะฒะตั: {answer}"}

ย ย ],

ย ย temperature=0.7, ย# ะะฐะทะฝะพะพะฑัะฐะทะธะต ะพัะฒะตัะพะฒ

ย ย max_tokens=300, ย # ะะณัะฐะฝะธัะตะฝะธะต ะดะปะธะฝั

ย ย response_format={"type": "json_object"} ย# ะะฐัะฐะฝัะธั JSON

)

```

  

### 7.4 Fallback ะฟัะธ ัะฑะพะต LLM

  

```python

FALLBACK_MESSAGES = [

ย ย "ะัะปะธัะฝะฐั ัะฐะฑะพัะฐ! ะัะฒะตั ะฟัะธะฝัั โ",

ย ย "ะฅะพัะพัะพ ะฟะพัะฐะฑะพัะฐะป! ะะฒะธะณะฐะตะผัั ะดะฐะปััะต ๐ช",

ย ย "ะัะธะฝััะพ! ะขั ะผะพะปะพะดะตั โจ"

]

  

async def check_homework(user_answer, lesson):

ย ย try:

ย ย ย ย result = await call_llm(user_answer, lesson)

ย ย ย ย return result

ย ย except (Timeout, JSONDecodeError, APIError):

ย ย ย ย # ะัะปะธ ัะตะบัั ะดะพััะฐัะพัะฝะพะน ะดะปะธะฝั โ ะทะฐััะธััะฒะฐะตะผ

ย ย ย ย if len(user_answer) >= 20:

ย ย ย ย ย ย return {

ย ย ย ย ย ย ย ย "verdict": "ACCEPT",

ย ย ย ย ย ย ย ย "message": random.choice(FALLBACK_MESSAGES)

ย ย ย ย ย ย }

ย ย ย ย else:

ย ย ย ย ย ย return {

ย ย ย ย ย ย ย ย "verdict": "REVISE",

ย ย ย ย ย ย ย ย "message": "ะะพะถะฐะปัะนััะฐ, ะฝะฐะฟะธัะธ ะพัะฒะตั ะฟะพะดัะพะฑะฝะตะต"

ย ย ย ย ย ย }

```

  

---

  

## 8. ะะดะผะธะฝ-ะฟะฐะฝะตะปั

  

### 8.1 ะะพะผะฐะฝะดั (ะดะพัััะฟ ะฟะพ whitelist ID)

  

|ะะพะผะฐะฝะดะฐ|ะะฟะธัะฐะฝะธะต|

|---|---|

|`/stat`|ะกัะฐัะธััะธะบะฐ: ัะบะพะปัะบะพ ะปัะดะตะน ะฝะฐ ะบะฐะบะพะผ ััะพะบะต|

|`/users`|ะกะฟะธัะพะบ ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะธั ััะฐัััะพะผ|

|`/unlock_all <tg_id>`|ะัะบัััั ะฒัะต ััะพะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั (ัะบัััะตะฝะฝะพ)|

|`/force_accept <tg_id> <lesson>`|ะะฐััะธัะฐัั ััะพะบ ะฒัััะฝัั|

|`/add_code <code>`|ะะพะฑะฐะฒะธัั ะบะพะด ะดะพัััะฟะฐ|

|`/codes`|ะกะฟะธัะพะบ ะฝะตะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะบะพะดะพะฒ|

|`/logs [n]`|ะะพัะปะตะดะฝะธะต N ะฒะตัะดะธะบัะพะฒ AI|

|`/backup`|ะกะพะทะดะฐัั ะธ ะพัะฟัะฐะฒะธัั ะฑัะบะฐะฟ ะะ ัะตะนัะฐั|

|**`/broadcast <ัะตะบัั>`**|**ะัะฟัะฐะฒะธัั ัะพะพะฑัะตะฝะธะต ะฒัะตะผ ัััะดะตะฝัะฐะผ**|

  

### 8.2 ะะพะผะฐะฝะดะฐ /broadcast

  

```python

@admin_only

async def broadcast_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):

ย ย """ะะฐัััะปะบะฐ ัะพะพะฑัะตะฝะธั ะฒัะตะผ ะฐะบัะธะฒะฝัะผ ัััะดะตะฝัะฐะผ"""

ย ย if not context.args:

ย ย ย ย await update.message.reply_text("ะัะฟะพะปัะทะพะฒะฐะฝะธะต: /broadcast <ัะตะบัั ัะพะพะฑัะตะฝะธั>")

ย ย ย ย return

ย ย message_text = " ".join(context.args)

ย ย # ะะพะปััะฐะตะผ ะฒัะตั ะฐะบัะธะฒะฝัั ัััะดะตะฝัะพะฒ

ย ย students = await db.get_all_enrolled_users()

ย ย sent = 0

ย ย failed = 0

ย ย for student in students:

ย ย ย ย try:

ย ย ย ย ย ย await bot.send_message(student.tg_id, message_text)

ย ย ย ย ย ย sent += 1

ย ย ย ย ย ย await asyncio.sleep(0.05) ย# ะะฝัะธ-ัะปัะด

ย ย ย ย except TelegramError:

ย ย ย ย ย ย failed += 1

ย ย await update.message.reply_text(

ย ย ย ย f"โ ะะฐัััะปะบะฐ ะทะฐะฒะตััะตะฝะฐ\n"

ย ย ย ย f"๐จ ะัะฟัะฐะฒะปะตะฝะพ: {sent}\n"

ย ย ย ย f"โ ะะต ะดะพััะฐะฒะปะตะฝะพ: {failed}"

ย ย )

```

  

**ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั:**

  

```

/broadcast ๐ข ะะฐะฟะพะผะธะฝะฐะตะผ: 2-8 ัะตะฒัะฐะปั โ ะฝะตะดะตะปั ะฟัะฐะบัะธะบะธ! ะัะพะฒะพะดะธัะต ัะฒะพะธ ััะตะฝะธะฝะณะธ.

  

/broadcast ๐ 9 ัะตะฒัะฐะปั โ ะพััะปะฐะนะฝ ััะตะฝะธะฝะณ ะดะปั ะฝะพะฒะธัะบะพะฒ! ะะต ะทะฐะฑัะดััะต ะฟัะธะนัะธ.

  

/broadcast โฐ ะะพ ะบะพะฝัะฐ ะบัััะฐ ะพััะฐะปะฐัั ะฝะตะดะตะปั. ะฃัะฟะตะนัะต ัะดะฐัั ะฒัะต ะะ!

```

  

### 8.3 ะัะธะผะตั ะฒัะฒะพะดะฐ /stat

  

```

๐ ะกัะฐัะธััะธะบะฐ ะบัััะฐ

  

ะัะตะณะพ ัััะดะตะฝัะพะฒ: 47

ะะบัะธะฒะฝัั: 42

  

ะะพ ััะพะบะฐะผ:

โ ะฃัะพะบ 1: 5 ัะตะป (ะทะฐะฒะตััะธะปะธ)

โ ะฃัะพะบ 2: 8 ัะตะป

โ ะฃัะพะบ 3: 12 ัะตะป โ ะฟะธะบะพะฒัะน

โ ะฃัะพะบ 4: 7 ัะตะป

โ ...

โ ะฃัะพะบ 18: 2 ัะตะป (ัะธะฝะธัะธัะพะฒะฐะปะธ)

  

โณ ะะดัั ะพัะบัััะธั: 8 ัะตะป

โ ะะฐะฑัะพัะตะฝะฝัั (>7 ะดะฝะตะน): 5 ัะตะป

```

  

---

  

## 9. ะขะตัะฝะธัะตัะบะธะน ััะตะบ

  

### 9.1 ะัะฝะพะฒะฝะพะน ััะตะบ

  

| ะะพะผะฟะพะฝะตะฝั ย | ะขะตัะฝะพะปะพะณะธั ย ย ย ย ย| ะะตััะธั ย ย ย|

| ----------- | ------------------- | ----------- |

| ะฏะทัะบ ย ย ย ย| Python ย ย ย ย ย ย ย| 3.11 ย ย ย ย|

| Telegram ย ย| python-telegram-bot | 20+ (async) |

| ะะฐะทะฐ ะดะฐะฝะฝัั | PostgreSQL ย ย ย ย ย| 15+ ย ย ย ย |

| ORM/Driver ย| asyncpg ย ย ย ย ย ย | latest ย ย ย|

| LLM ย ย ย ย | OpenAI API ย ย ย ย ย| gpt-4o-mini |

| ะะปะฐะฝะธัะพะฒัะธะบ | APScheduler ย ย ย ย | 3.10+ ย ย ย |

| ะฅะพััะธะฝะณ ย ย | Railway ย ย ย ย ย ย | - ย ย ย ย ย |

  

### 9.2 ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

  

```

course_bot/

โโโ bot/

โ ย โโโ __init__.py

โ ย โโโ main.py ย ย ย ย ย ย ย# ะขะพัะบะฐ ะฒัะพะดะฐ

โ ย โโโ handlers/

โ ย โ ย โโโ start.py ย ย ย ย # /start, ะฐะบัะธะฒะฐัะธั

โ ย โ ย โโโ lessons.py ย ย ย # ะัะพัะผะพัั ััะพะบะพะฒ

โ ย โ ย โโโ homework.py ย ย ย# ะกะดะฐัะฐ ะะ

โ ย โ ย โโโ support.py ย ย ย # ะะพะฟัะพัั ะบััะฐัะพัั

โ ย โ ย โโโ admin.py ย ย ย ย # ะะดะผะธะฝ-ะบะพะผะฐะฝะดั

โ ย โโโ services/

โ ย โ ย โโโ llm.py ย ย ย ย ย # ะะฐะฑะพัะฐ ั OpenAI

โ ย โ ย โโโ scheduler.py ย ย # ะะฐัะฟะธัะฐะฝะธะต ััะพะบะพะฒ

โ ย โ ย โโโ notifications.py # ะัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน

โ ย โโโ database/

โ ย โ ย โโโ models.py ย ย ย ย# ะะพะดะตะปะธ ะดะฐะฝะฝัั

โ ย โ ย โโโ queries.py ย ย ย # SQL-ะทะฐะฟัะพัั

โ ย โ ย โโโ connection.py ย ย# ะัะป ัะพะตะดะธะฝะตะฝะธะน

โ ย โโโ states.py ย ย ย ย ย ย# FSM ัะพััะพัะฝะธั

โ ย โโโ config.py ย ย ย ย ย ย# ะะพะฝัะธะณััะฐัะธั

โโโ migrations/

โ ย โโโ 001_initial.sql

โโโ tests/

โโโ .env.example

โโโ requirements.txt

โโโ README.md

```

  

### 9.3 ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

  

```env

# Telegram

BOT_TOKEN=xxx

CURATOR_ID=123456789 ย# ID ะบััะฐัะพัะฐ ะดะปั ะฟะตัะตััะปะบะธ ะฒะพะฟัะพัะพะฒ

ADMIN_IDS=123,456,789 ย# ะกะฟะธัะพะบ ะฐะดะผะธะฝะพะฒ (ะดะปั ะบะพะผะฐะฝะด ัะฟัะฐะฒะปะตะฝะธั)

  

# Database

DATABASE_URL=postgresql://user:pass@localhost:5432/course_bot

  

# OpenAI

OPENAI_API_KEY=sk-xxx

  

# Settings

TIMEZONE=Asia/Almaty

LLM_TIMEOUT=15

MIN_ANSWER_LENGTH=20

RATE_LIMIT_PER_HOUR=7

```

  

---

  

## 10. ะะธัะบะธ ะธ ะผะธัะธะณะฐัะธั

  

|ะะธัะบ|ะะตัะพััะฝะพััั|ะะปะธัะฝะธะต|ะะธัะธะณะฐัะธั|

|---|---|---|---|

|LLM ะณะฐะปะปััะธะฝะธััะตั/ะณััะฑะธั|ะกัะตะดะฝัั|ะััะพะบะพะต|ะกััะพะณะธะน ะฟัะพะผะฟั + ะผะพะดะตัะฐัะธั ะฟะตัะฒัั 50 ะพัะฒะตัะพะฒ|

|ะฎะทะตัั ัะฟะฐะผัั ัะดะฐัั ะะ|ะััะพะบะฐั|ะะธะทะบะพะต|Rate limiting: 7 ะฟะพะฟััะพะบ ะฒ ัะฐั|

|ะฎะทะตั ะทะฐััััะป ะธ ะฝะต ะผะพะถะตั ัะดะฐัั|ะกัะตะดะฝัั|ะััะพะบะพะต|ะะฝะพะฟะบะฐ "ะัะธะฑะบะฐ AI" + /force_accept|

|ะะ ะฟะตัะตะฟะพะปะฝัะตััั|ะะธะทะบะฐั|ะกัะตะดะฝะตะต|ะะธะผะธั ะฝะฐ ะดะปะธะฝั submissions, ะพัะธััะบะฐ ััะฐััั ะปะพะณะพะฒ|

|ะะพั ะฟะฐะดะฐะตั|ะกัะตะดะฝัั|ะััะพะบะพะต|Supervisor/systemd ะดะปั ะฐะฒัะพะฟะตัะตะทะฐะฟััะบะฐ|

|ะกััะดะตะฝั ะฑัะพัะธะป ะบััั|ะััะพะบะฐั|ะกัะตะดะฝะตะต|ะะฐะฟะพะผะธะฝะฐะฝะธั ัะตัะตะท 3 ะธ 7 ะดะฝะตะน|

  

---

  

# โ ะะกะ ะะะะะะกะซ ะะะจะะะซ

  

## ะคะธะฝะฐะปัะฝัะต ััะพัะฝะตะฝะธั:

  

|ะะพะฟัะพั|ะัะฒะตั|

|---|---|

|ะัะผะตัะฐัะธั ััะพะบะพะฒ|1-18 (ััะพะบ 12 = ะะตัะปะตะพะฑัะฐะทะฝะพะต ัะฐะทะฒะธัะธะต)|

|ะัะฐะบัะธะบะธ ะฒ ัะฐัะฟะธัะฐะฝะธะธ|ะฃะฑัะฐะฝั, ะดะตะปะฐะตะผ ัะตัะตะท `/broadcast`|

|ะะฐัะฟะธัะฐะฝะธะต ััะพะบะพะฒ|ะะตั ะฟัะธะฒัะทะบะธ ะบ ะดะฐัะฐะผ, ะบะฐะถะดัะน ะธะดะตั ะฒ ัะฒะพะตะผ ัะตะผะฟะต|

|ะะพะณะธะบะฐ ะพัะบัััะธั|ะกะดะฐัะฐ ะะ + 1 ะดะตะฝั = ัะปะตะดัััะธะน ััะพะบ|

|ะะพะปะธัะตััะฒะพ ัััะดะตะฝัะพะฒ|ะะพ 50 ัะตะปะพะฒะตะบ|

|Rate limiting|7 ะฟะพะฟััะพะบ ะฒ ัะฐั|

|**ะะธะดะตะพ-ะทะฐะดะฐะฝะธั (4, 9)**|ะัะพััะพ ัััะปะบะฐ, ะฑะตะท ะพะฟะธัะฐะฝะธั|

|**ะคะพัะผะฐัั ัะฐะนะปะพะฒ (ััะพะบ 11)**|ะขะพะปัะบะพ PDF ะธ DOCX|

|**ะะตะฒะตัะฝัะน ัะพัะผะฐั ัะฐะนะปะฐ**|ะะพั ะฟัะพัะธั ะฟัะธะบัะตะฟะธัั ะฒ ะฟัะฐะฒะธะปัะฝะพะผ ัะพัะผะฐัะต|

|**ะงะฐั ะฟะพะดะดะตัะถะบะธ**|ะะดะธะฝ ะบััะฐัะพั|

|ะะพะดั ะดะพัััะฟะฐ|ะัะปะพะถะตะฝะพ ะดะพ ััะพัะฝะตะฝะธั ะพั ัะฐะฑะพัะพะดะฐัะตะปั|

  

---

  

## ะะตะบะพะผะตะฝะดะฐัะธะธ:

  

### ๐ข ะะพะฑะฐะฒะธัั ะฒ MVP:

  

1. **ะะฝะพะฟะบะฐ "ะญัะพ ะพัะธะฑะบะฐ AI"**

ย ย - ะัะปะธ AI ะพัะบะปะพะฝะธะป ะฝะพัะผะฐะปัะฝัะน ะพัะฒะตั โ ัััะดะตะฝั ะถะผะตั ะบะฝะพะฟะบั

ย ย - ะกะพะพะฑัะตะฝะธะต ัะปะตัะฐะตั ะบััะฐัะพัั ั ะบะพะฝัะตะบััะพะผ

ย ย - ะััะฐัะพั ะผะพะถะตั ะทะฐััะธัะฐัั ะฒัััะฝัั ัะตัะตะท `/force_accept`

2. **ะัะพะณัะตัั-ะฑะฐั ะดะปั ัััะดะตะฝัะฐ**

ย ย - "ะั ะฟัะพัะปะธ 5 ะธะท 18 ััะพะบะพะฒ (27%)"

ย ย - ะะพัะธะฒะธััะตั ะฟัะพะดะพะปะถะฐัั

3. **ะัะตะดัะฟัะตะถะดะตะฝะธะต ะพ rate limit**

ย ย - "ะััะฐะปะพัั 2 ะฟะพะฟััะบะธ ะฒ ััะพะผ ัะฐัะต"

ย ย - ะงัะพะฑั ัััะดะตะฝั ะฝะต ััะฐัะธะป ะฟะพะฟััะบะธ ะฒะฟััััั

  

### ๐ก ะะฐ ััะพ ะพะฑัะฐัะธัั ะฒะฝะธะผะฐะฝะธะต:

  

1. **AI ัะปะธัะบะพะผ ัััะพะณะธะน ะบ ัะฒะพััะตัะบะธะผ ะทะฐะดะฐะฝะธัะผ**

ย ย - ะฃัะพะบ 12 โ "ะะฐะฟะธัะธัะต ัะบะฐะทะบั ะฟัะพ ััะตะฝะตัะฐ"

ย ย - **ะะตัะตะฝะธะต:** ะ ะฟัะพะผะฟัะต ัะบะฐะทะฐัั "ัะฒะพััะตัะบะพะต ะทะฐะดะฐะฝะธะต, ะฟัะธะฝะธะผะฐัั ะปัะฑะพะน ัะฒัะทะฝัะน ัะตะบัั"

2. **ะัะพะฒะตัะบะฐ YouTube ัััะปะพะบ**

ย ย - ะะฐะปะธะดะธัะพะฒะฐัั ััะพ ััะพ youtube.com ะธะปะธ youtu.be

ย ย - ะะต ะฟัะธะฝะธะผะฐัั ะดััะณะธะต ัััะปะบะธ

3. **ะัะพะฒะตัะบะฐ ัะฐะนะปะพะฒ**

ย ย - ะขะพะปัะบะพ PDF ะธ DOCX

ย ย - ะะฐะทะผะตั > 1KB (ะทะฐัะธัะฐ ะพั ะฟััััั ัะฐะนะปะพะฒ)

ย ย - ะะฐะทะผะตั < 20MB (ะพะณัะฐะฝะธัะตะฝะธะต Telegram)

  

### ๐ด ะัะธัะธัะฝัะต ะผะพะผะตะฝัั ะฟะตัะตะด 12 ัะฝะฒะฐัั:

  

1. **ะขะตััะธัะพะฒะฐะฝะธะต:**

ย ย - ะะธะฝะธะผัะผ 3 ะฟะพะปะฝัั ะฟัะพัะพะดะฐ ะฟะพ ะฒัะตะผ 18 ััะพะบะฐะผ

ย ย - ะัะพะฒะตัะธัั: ัะตะบัั, ัะฐะนะป (PDF + DOCX + ะฝะตะฒะตัะฝัะน ัะพัะผะฐั), ะฒะธะดะตะพ-ัััะปะบะฐ, ััะพะบะธ ะฑะตะท ะะ

ย ย - ะัะพะฒะตัะธัั rate limiting (ะพัะฟัะฐะฒะธัั 8 ัะพะพะฑัะตะฝะธะน ะฟะพะดััะด)

2. **ะะตัะฒัะต 2 ะดะฝั ะฟะพัะปะต ะทะฐะฟััะบะฐ:**

ย ย - ะััั ะพะฝะปะฐะนะฝ ะธ ะผะพะฝะธัะพัะธัั ะปะพะณะธ AI

ย ย - ะะพัะพะฒะฝะพััั ะธัะฟะพะปัะทะพะฒะฐัั `/force_accept` ะธ `/unlock_all`

3. **ะัะบะฐะฟั:**

ย ย - ะะฐัััะพะธัั ะะ ะทะฐะฟััะบะฐ

ย ย - ะัะพะฒะตัะธัั ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ะธะท ะฑัะบะฐะฟะฐ

4. **ะงะตะบ-ะปะธัั ะฟะพะดะณะพัะพะฒะบะธ:**

ย ย - [ ] ะะพะดั ะดะพัััะฟะฐ ะดะปั ะฒัะตั 50 ัััะดะตะฝัะพะฒ

ย ย - [ ] Telegram ID ะบััะฐัะพัะฐ ะดะปั ะฟะตัะตััะปะบะธ ะฒะพะฟัะพัะพะฒ

ย ย - [ ] ะขะตะบััั ะฒัะตั 18 ััะพะบะพะฒ ะฒ ะะ

ย ย - [ ] ะขะตััะพะฒัะน ะฟัะพะณะพะฝ

---

_ะะพะบัะผะตะฝั ะพะฑะฝะพะฒะปะตะฝ: ะฏะฝะฒะฐัั 2026_ ย
_ะะตััะธั: 3.0 (ัะธะฝะฐะปัะฝะฐั)_